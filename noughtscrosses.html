<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div id="container"></div>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.5.4.min.js"></script>
    <script>window.Kinetic || document.write('<script src="static/js/kinetic-v4.5.4.min.js">\x3C/script>')</script>
    <script>
      var WIDTH = 500;
      var HEIGHT = 500;
      var stage = new Kinetic.Stage({
        container: 'container',
        width: WIDTH,
        height: HEIGHT
      });

      function draw_board(layer) {
        var x_gap = WIDTH/3;
        var y_gap = HEIGHT/3;
        add_line(layer, [[x_gap*1,       0], [x_gap*1, HEIGHT]]);
        add_line(layer, [[x_gap*2,       0], [x_gap*2, HEIGHT]]);
        add_line(layer, [[      0, y_gap*1], [  WIDTH, y_gap*1]]);
        add_line(layer, [[      0, y_gap*2], [  WIDTH, y_gap*2]]);
        for (var x=0; x<3; x++) {
          for (var y=0; y<3; y++) {
            var rect = add_rect(layer, x_gap*x, y_gap*y, x_gap, y_gap);
            rect.on('mouseover touchstart', function() {
              this.setFill('blue');
              layer.draw();
            });
            rect.on('mouseout touchend', function() {
              this.setFill('green');
              layer.draw();
            });
          }
        }
      }

      function add_line(layer, points) {
        var line = new Kinetic.Line({
          points: points,
          stroke: 'black',
          strokeWidth: 5,
        });
        layer.add(line)
        return line;
      }

      function add_rect(layer, x, y, width, height) {
        var rect = new Kinetic.Rect({
          x: x,
          y: y,
          width: width,
          height: height,
          fill: 'green',
          strokeWidth: 4
        });
        layer.add(rect)
        return rect;
      }

      var base = new Kinetic.Layer();
      draw_board(base);
      stage.add(base);

      function create_grid(n, m, elem) {
        grid = new Array(n);
        for (var x=0; x<n; x++) {
          grid[x] = new Array(m);
          for (var y=0; y<m; y++) {
            grid[x][y] = elem;
          }
        }
        return grid;
      }

      function Model() {
        var grid_size = 9;
        this.grid = create_grid(grid_size);
        this.player_turn = 'X';
      }

      Model.prototype.next_turn = function() {
        this.player_turn = this.player_turn == 'X' ? 'O' : 'X';
        return this.player_turn;
      }

      Model.prototype.at = function(x, y) {
        return this.grid[x][y];
      }
    </script>
  </body>
</html>
